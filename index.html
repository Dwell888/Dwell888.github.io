<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bad PvZ</title>
<style>
body {
  margin: 0;
  background: #4caf50;
  font-family: Arial, sans-serif;
  color: white;
}
#game {
  display: grid;
  grid-template-columns: repeat(9, 80px);
  gap: 4px;
  padding: 10px;
}
.cell {
  width: 80px;
  height: 80px;
  background: #6ab04c;
  border: 2px solid #2d3436;
  text-align: center;
  line-height: 80px;
  font-size: 12px;
  cursor: pointer;
}
.zombie {
  background: brown;
}
.plant {
  background: green;
}
#ui {
  padding: 10px;
  background: #2d3436;
}
</style>
</head>

<body>

<div id="ui">
  <span id="level">Level 1</span> |
  <span id="kills">Kills: 0</span>
</div>

<div id="game"></div>

<h3>Global Leaderboard</h3>
<ol id="leaderboard"></ol>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”¥ PASTE YOUR FIREBASE CONFIG HERE
firebase.initializeApp({
  apiKey: "AIzaSyDTVwYsjkGD7a6Ji1Q4p-n8Doud4mqGTk8",
  authDomain: "pvweb-d1809.firebaseapp.com",
  databaseURL: "pvweb-d1809.firebaseio.com",
  projectId: "pvweb-d1809"
});

const db = firebase.database();

const username = prompt("Enter your PvZ username") || "Anonymous";

const lanes = 5;
const cols = 9;
let level = 1;
let kills = 0;

const game = document.getElementById("game");
const killsEl = document.getElementById("kills");
const levelEl = document.getElementById("level");

let grid = [];

function createGrid() {
  game.innerHTML = "";
  grid = [];
  for (let i = 0; i < lanes * cols; i++) {
    const cell = document.createElement("div");
    cell.className = "cell";
    cell.onclick = () => placePlant(i);
    game.appendChild(cell);
    grid.push({ plant: false, zombie: false });
  }
}

function placePlant(i) {
  if (!grid[i].plant) {
    grid[i].plant = true;
    game.children[i].classList.add("plant");
    game.children[i].textContent = "ðŸŒ±";
  }
}

function spawnZombie() {
  const lane = Math.floor(Math.random() * lanes);
  const index = lane * cols + (cols - 1);
  grid[index].zombie = true;
  game.children[index].classList.add("zombie");
  game.children[index].textContent = "ðŸ§Ÿ";
}

function tick() {
  for (let i = 0; i < grid.length; i++) {
    if (grid[i].zombie) {
      const next = i - 1;
      if (next < 0) continue;

      if (grid[next].plant) {
        grid[i].zombie = false;
        grid[next].plant = false;
        game.children[i].className = "cell";
        game.children[next].className = "cell";
        game.children[next].textContent = "";
        kills++;
        killsEl.textContent = "Kills: " + kills;
        updateScore();
      } else {
        grid[i].zombie = false;
        grid[next].zombie = true;
        game.children[i].className = "cell";
        game.children[i].textContent = "";
        game.children[next].classList.add("zombie");
        game.children[next].textContent = "ðŸ§Ÿ";
      }
    }
  }
}

function updateScore() {
  db.ref("scores/" + username).set(kills);
}

function loadLeaderboard() {
  db.ref("scores").on("value", snap => {
    const data = snap.val() || {};
    const sorted = Object.entries(data)
      .sort((a,b) => b[1] - a[1])
      .slice(0, 10);

    const list = document.getElementById("leaderboard");
    list.innerHTML = "";
    sorted.forEach(([name, score]) => {
      const li = document.createElement("li");
      li.textContent = `${name}: ${score}`;
      list.appendChild(li);
    });
  });
}

function nextLevel() {
  if (level < 10) {
    level++;
  } else {
    level = 11; // infinite
  }
  levelEl.textContent = "Level " + level;
}

createGrid();
loadLeaderboard();

setInterval(spawnZombie, 2000);
setInterval(tick, 800);
setInterval(nextLevel, 15000);
</script>

</body>
</html>
